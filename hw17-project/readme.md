# **ТЗ на разработку сервиса "Подбор туров"**

Сервис предназначен для быстрого поиска номеров отелей и связи с менеджером. Сервис предоставляет rest api интерфейс для web/mobile/desktop приложений. Сервис состоит из 2х SOA сервисов.

**1 Сервис интеграционный занимается генерацией данных и отправкой их в кафку.**   
Сервис использует библиотеку faker (github.com/go-faker/faker/v4  
) для генерации данных. Базу данных posgresSql и бибилотеку (https://github.com/jackc/pgx) для запросов. Для миграций [https://github.com/pressly/goose\#go-migrations](https://github.com/pressly/goose#go-migrations).    
Для записи в кафку будет использована библиотека [https://github.com/segmentio/kafka-go](https://github.com/segmentio/kafka-go).

Будет несколько команд.   
1 \- запускается 1 раз в ручную она генерирует отели , направления (страны), типы питания. Можно указать сколько направлений нам надо сгенерировать и сколько отелей в каждом направлении. И складывает их в БД. Типов питания будет фиксировано 5 штук. Они будут рандомно привязываться к отелю от 2х до 5х (при создании отеля).   
2 \- Генерирует даты и цены (по группам туристов будет пока 3 группы туристов A, AA, AAA,  A \- значит adult взрослый). В команде можно указать количество месяцев на которые надо на генерировать данные. Длительности туров будут фиксированны 3-7 дней.   
3 \- Обновляет цены ежедневно в созданных прайс листах добавляя к ним \+0.5% стоимости ежедневно. И удаляет цены которые по дате date\_start \< now().   
**Структура БД сервиса интеграции:**   
![][/images/image1.png](hw17-project/images/image1.png)

**Цены будут генерироваться по такой логике  :**   
количество отелей \* 180 дней (3 месяца) \* количество длительностей \* количество групп туристов (3) \* количество питаний привязанное к отелю (от 2х до 5\)

Апи методы. Для получения данных по статическим сущностям.   
**Список локаций :**   
api/v1/locations   
тип \- POST   
параметры запроса \- ids (массив ид локаций) если не передано то выдаются все локации.   
Ответ в формате json   
{‘data’: \[   
{  
id: int   
name: string   
},  
{  
id \=\> int   
name \=\> string   
}  
\]  
}

**Список отелей:**  
api/v1/hotels   
тип \- POST   
параметры запроса \- ids (массив ид отелей), page страница ,если не передано ids  то выдаются по 500 отелей с пагинацией.   
Ответ в формате json   
{‘data’ \=\> \[  
{  
id: int   
name: string  
line: int   
boards: array,  
location\_id: int   
description: string  
},  
{  
id: int   
name: string  
line: int   
boards: array,  
location\_id: int   
description: string  
}  
\],  
‘has\_next’ \=\> bool,  
‘page’ \=\> int  
}

**Список питаний :**   
api/v1/boards   
тип \- GET  
Ответ в формате json   
{‘data’: \[   
{  
id: int   
name: string   
},  
{  
id \=\> int   
name \=\> string   
}  
\]  
}

**2 Сервис поиска**   
Сервис поиска предоставляет rest api интерфейс для удобного поиска отелей.   
**Сервис использует базу данных posgresSql для статических данных** (которые редко меняются) и бибилотеку (https://github.com/jackc/pgx) для запросов. Для миграций [https://github.com/pressly/goose\#go-migrations](https://github.com/pressly/goose#go-migrations).   
Для чтения из кафки будет использована библиотека [https://github.com/segmentio/kafka-go](https://github.com/segmentio/kafka-go).    
**Для списка цен и быстрого поиска по ним** будет использовать БД clickhouse c бибилиотеками [https://github.com/ClickHouse/clickhouse-go/](https://github.com/ClickHouse/clickhouse-go/) и  [https://github.com/pressly/goose\#go-migrations](https://github.com/pressly/goose#go-migrations)  
Для кеширования данных будет использоваться Redis с бибилотекой [`github.com/redis/go-redis/`](http://github.com/redis/go-redis/)`.`



Сервис имеет следующие команды :   
1 Команда импорта питаний. Она по https делает запрос в сервис интеграции и забирает все типы питаний. Запускается один раз при первом деплое а дальше по потребности..   
2 Команда импорта отелей. Она по https делает запрос в сервис интеграции и забирает все отели. Запускается один раз при первом деплое а дальше по потребности..   
3 Команда импорта локаций. Она по https делает запрос в сервис интеграции и забирает все локации. Запускается один раз при первом деплое а дальше по потребности.

**Структура postgreSQL сервиса поиска**  
![][images/image2.png](hw17-project/images/image2.png)


**Структура clockhouse сервиса поиска**  
![][images/image3.png](hw17-project/images/image3.png)

REST API методы сервиса

**1 Список направлений**    
api/v1/directions   
Тип GET   
**Параметры запроса** \- direction\_search // поиск направлений по тексту по полю location.name   
Ответ в формате json   
{‘data’: \[   
{  
id: int   
name: string   
},  
{  
id \=\> int   
name \=\> string   
}  
\]  
}  
Список направлений будет кэшироваться на сутки TTL 24 \* 60 \* 60 (в секундах)

**2 Список фильтров по умолчанию и максимальные диапазоны**   
api/v1/filters   
Тип GET   
**Параметры запроса** \- direction\_id // ид направления оно нужно для создания ‘data\_confines’

**Ответ в формате json (пример)**  
{  
‘data\_default’: {   
date\_start: { // диапазон начала дат тура, статика   
‘from’: 2025-05-10’,   
‘to’: 2025-05-15’,   
},  
duration: { // диапазон длительности тура, статика  
‘from’: 5’,   
‘to’:7,    
},  
tourists\_group: ‘AA’, // статика  
direction: {‘id’: 260, “name”: Турция} // статика   
}  
‘data\_confines’: { // вся агрегация выполняется одним запросов и кешируется на сутки либо по дефолтному направлению либо по указанному  
‘duration’: {min:3, max:8},     
‘date\_start’: {‘min’: now(), ‘max’: 2025-11-20}   
‘tourists\_group’: \[‘A’, ‘AA’,  ‘AAA’ \]  
‘stars’: \[1, 2, 3, 4 ,5\],  // звездность  
‘beach\_line’: \[1,2,3\],  
‘boad\_type’ \[‘AI’, ‘FB’, ‘UAI’, ‘RO’\]  
}  
}

**3 Список отелей**  
api/v1/hotels-prices  
(в разработке)

**Общая схема проекта** 
![][images/image4.png](hw17-project/images/image4.png)